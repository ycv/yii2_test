$.getJSON(basepath+"/factorydata/citiesdatas/sql_areas.json",function(c){for(var a=0;a<c.length;a++){var b={id:c[a].id,name:c[a].cname,level:c[a].level,parentId:c[a].upid};c[a]=b}$(".bs-chinese-region").chineseRegion("source",c).on("completed.bs.chinese-region",function(f,d){$(this).find("[name=AdduserForm_address]").val(d[0].name+","+d[1].name+","+d[2].name)})});$(function(){$("#dright_content").html("&nbsp;&nbsp;&nbsp;用户添加");$("#data_xianxu").click(function(){var c=0;if($("#city").children("a").length>0){$("#city").children("a").each(function(){if($(this).hasClass("current")){c=1;return false}})}if(0==c){$("#district").html('<h4 style="color: #337ab7;cursor:help;">请先选择城市!</h4>')}});function b(d,c){return Math.floor(Math.random()*(c-d+1)+d)}function a(){$("#captchaOperation").html([b(1,20),"+",b(20,30),"="].join(" "))}a();$("#adduserdatas").formValidation({message:"This value is not valid",icon:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{"AdduserForm[username]":{validators:{notEmpty:{message:"名字不能为空!"},stringLength:{min:6,max:15,message:"用户名必须超过6，不超过15个字符"},remote:{type:"POST",url:basepath+"/study/default/addusernameisexists",delay:1000,message:"用户已存在",data:{_csrf:$("input[name='_csrf']").val()}}}},"AdduserForm[useremail]":{validators:{notEmpty:{message:"邮箱不能为空!"},emailAddress:{message:"请填写正确邮箱格式!"}}},"AdduserForm[usersex]":{validators:{notEmpty:{message:"请选择性别!"}}},validate__address:{validators:{callback:{message:"请选择地址到县区级!",callback:function(e){var c=/[\s]/g;var d=0;if(c.test(e)){d=e.match(c).length}return 3==d}}}},"AdduserForm[userInterest][]":{validators:{notEmpty:{message:"请选择一个兴趣爱好!"}}},captcha:{validators:{callback:{message:"答案错误!",callback:function(f,d){var c=$("#captchaOperation").html().split(" "),e=parseInt(c[0])+parseInt(c[2]);return f==e}}}}}}).on("err.form.fv",function(f){f.preventDefault();var d=$(f.target),c=d.data("formValidation");if(!c.isValidField("captcha")){a()}}).on("status.field.fv",function(d,c){}).on("success.form.fv",function(f){f.preventDefault();var d=$(f.target);var c=d.data("formValidation");if(c.isValidField("AdduserForm[usersex]")&&c.isValidField("AdduserForm[userInterest][]")&&c.isValidField("validate__address")&&c.isValidField("captcha")){$.post(d.attr("action"),d.serialize(),function(e){$("#datassubmit").attr("disabled","disabled");$("#resetBtn").attr("disabled","disabled");if(e.retval){jAlert("添加数据成功！请稍等...","警告对话框");setTimeout(function(){$("#popup_ok").click();$("li[data3='userlistdatas']").click()},1500)}else{jAlert("添加数据有误！请稍等...","警告对话框");setTimeout(function(){$("#popup_ok").click();window.location.reload()},1500)}},"json")}}).find('div[aria-labelledby="dLabel"]').click(function(){$("#adduserdatas").data("formValidation").revalidateField("validate__address")});$("#resetBtn").click(function(){$("#adduserdatas").data("formValidation").resetForm(true)})});