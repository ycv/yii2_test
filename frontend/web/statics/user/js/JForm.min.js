var JForm=function(e){function r(e,r){if(!e){if("text"==r.type||"textarea"==r.type||"password"==r.type||"email"==r.type){try{var t=h.message.empty.replace("{cname}",h.cname)}catch(n){t="请填写"+h.cname+"."}s("error",t,r)}else s("error","请选择"+h.cname,r);return!1}return!0}function t(e,r){var t=$(r).attr("min-length"),n=$(r).attr("max-length");return t&&e.length<t?(s("error",h.cname+"最少需要输入 "+t+" 个字符.",r),!1):n&&e.length>n?(s("error",h.cname+"最多可以输入 "+n+" 个字符.",r),!1):!0}function n(e){if("checkbox"==e.type&&void 0==h.checkboxsCache[e.name]){for(var r=parseInt($(e).attr("max-check")),t=parseInt($(e).attr("min-check")),n=0,a=$("#"+m.formId).find("input[name='"+e.name+"']"),c=0;c<a.length;c++)a[c].checked&&n++;if(t&&t>n)return s("error",h.cname+"至少要选中 "+t+" 项！",e),!1;if(r&&n>r)return s("error",h.cname+"最多选中 "+r+" 项！",e),!1;h.checkboxsCache[e.name]=1}return!0}function a(e,r){var t=$(r).attr("dtype");if("repass"==t){var n=$(r).attr("for-password");if(e!=$("#"+n).val())return s("error","确认密码必须和密码一致！",r),!1}return!0}function c(e,r){var t=$(r).attr("handler");if(t){var n=t.indexOf("("),a=t.indexOf(")"),c=t.substring(n+1,a),i=c.replace(/^\s+/g,"").split(","),o=new Function(i,"return "+t);if(!o(e,r))return!1}return!0}function i(e,r){var t=$(r).attr("ajax");return void 0!=t?($.ajax({url:t,data:{ajaxdata:e},type:"get",dataType:"json",async:!1,success:function(e){return"0"==e.code?!0:void s(e.code,e.message,r)}}),!1):!0}function o(e,r){var t=$(r).attr("dtype");if(!t)return!0;if("idnum"==t&&!h.idNumCheck(e))return s("error",h.failText,r),!1;if("number"==t){if(!h.regExp[t].test(e))return s("error",h.cname+"必须是数字！",r),!1;var n=$(r).attr("range");if(n){var a=n.split("-");return""!=a[1]&&e>a[1]?s("error",h.cname+"不能大于"+a[1]+".",r):""!=a[0]&&e<a[0]&&s("error",h.cname+"不能小于"+a[0]+".",r),e>=a[0]&&e<=a[1]}return!0}return h.regExp[t]&&!h.regExp[t].test(e)?(s("error",h.failText,r),!1):!0}function u(e){return e>=48&&57>=e?1:e>=65&&90>=e?2:e>=97&&122>=e?4:8}function f(e){for(var r=0,t=0;4>t;t++)1&e&&r++,e>>>=1;return r}function s(e,r,t){"error"==e&&(h.checkSuccess=!1),m.showMessage(e,r,t)}var m={formId:"",filter:function(e){return void 0==$(e).attr("required")},continueCheck:!1,showMessage:function(e,r,t){$(t).focus(),alert(r)}};e&&$.extend(m,e);var h={};return h.checkboxsCache={},h.checkSuccess=!0,h.cname="",h.failText="",h.message={},h.regExp={uname:/^[0-9|a-z|_]{4,20}$/i,email:/^[a-z0-9]\w{1,18}@[a-z0-9]{1,20}(\.[a-z]{1,6}){1,3}$/i,url:/^https?:\/\/(www\.)?\w+(\.[a-z|0-9]+){1,2}/i,domain:/^\w+(\.[a-z|0-9]+){1,2}$/i,mobile:/^1[3|4|5|7|8][0-9]{9}$/,phone:/^[0-9]{2,5}[-][0-9]{7,8}$/,number:/^[0-9]+$/,"float":/^[0-9]+\.[0-9]+/,cn:/^[\u4E00-\u9FA5]+$/,en:/^\w+$/,ip:/^([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/},h.checkFormData=function(){var e=document.getElementById(m.formId),u=e.elements,f=0,l=0;h.checkSuccess=!0;for(var d=0;d<u.length;d++){var p=u[d],g=p.value.trim(),k=!1;if(!m.filter(p)){if(f++,h.cname=$(p).attr("cname"),void 0==h.cname&&(h.cname=$(p).attr("placeholder")),h.failText=$(p).attr("message"),!h.failText)try{h.failText=h.message[$(p).attr("dtype")].replace("{cname}",h.cname)}catch(v){h.failText=h.cname+"格式错误."}if(!r(g,p)&&(k=!0,!m.continueCheck))break;if(!k&&!t(g,p)&&(k=!0,!m.continueCheck))break;if(!k&&!n(p)&&(k=!0,!m.continueCheck))break;if(!k&&!a(g,p)&&(k=!0,!m.continueCheck))break;if(!k&&!o(g,p)&&(k=!0,!m.continueCheck))break;if(!k&&!c(g,p)&&(h.checkSuccess=!1,k=!0,!m.continueCheck))break;if(!k&&!i(g,p)&&(k=!0,!m.continueCheck))break;k||"radio"==p.type||s("ok",h.cname+"填写正确！",p),h.checkSuccess&&l++}}return f==l},h.idNumCheck=function(e){if(18!=e.length)return!1;for(var r,t,n=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],a=[1,0,"X",9,8,7,6,5,4,3,2],c=new Array(17),i=0,o=0;17>o;o++)c[o]=parseInt(e.substring(o,o+1));for(var u=0;u<c.length;u++)i+=n[u]*c[u];return r=i%11,t=2==r?"X":a[r],t==e.substring(17,18)},h.getPassRank=function(e){if(e.length<=5)return 0;for(var r=0,t=0;t<e.length;t++)r|=u(e.charCodeAt(t));return f(r)},h.setMessage=function(e){"[object Object]"==Object.prototype.toString.call(e)&&(this.message=e)},h.addRegExp=function(e,r){h.regExp[e]=r},h};