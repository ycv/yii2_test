var JTemplate=function(){void 0==String.inc&&(String.prototype.inc=function(e){return this.indexOf(e)>-1}),void 0==String.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var o={};return o.GDATA={},o.tagPrefix="{[",o.tagSuffix="]}",o.debug=!1,o.__HELPER__={},o.clear=function(){return this.GDATA={},this},o.config=function(e,t){this[e]=t},o.assign=function(e,t){return this.GDATA[e]=t,this},o.helper=function(e,t){"function"!=typeof this.__HELPER__[e]&&(this.__HELPER__[e]=t)},o.render=function(tpl,data){function append(e,t){if(e){if(t)__CODE__+=e+"\n";else{var i=e.replace(/'/g,"\\'").replace(/[\n\t\r]+/g," ");__CODE__+="r.push('"+i+"');\n"}return this}}function compileVar(e){void 0!=__GDATA__[e]?append("r.push(this."+e+")",!0):append("r.push("+e+")",!0)}function compileLoop(e){var t=e.replace(/\s+/," ").split(" ");append("for ( var i = 0; i < this."+t[1]+".length; i++ ) {",!0),append("var "+t[2].replace(this.tagSuffix,"").replace(/\s+/g,"")+" = this."+t[1]+"[i];",!0),t[3]&&append("var "+t[3].replace(this.tagSuffix,"").replace(/\s+/g,"")+" = i;",!0)}function complieIf(e){e=e.replace("if","").trim(),append("if ( "+e+" ) {",!0)}function compileExpr(e){e=e.replace("expr:","").trim(),append(e,!0)}function compileTimeString(e){var t=new Date,i=e.replace("wxtime:",""),r=new Date;if(r.setTime(1e3*i),1e3*i>t.getTime())return r.getFullYear()+"年"+(r.getMonth()+1)+"月"+r.getDate()+"日";var a=Math.ceil(t.getTime()/1e3)-i;return 10>a?"刚刚":60>a?a+"秒前":3600>a?Math.floor(a/60)+"分钟前":86400>a&&r.getDate()==(new Date).getDate()?Math.floor(a/3600)+"小时前":86400>a&&r.getDate()<(new Date).getDate()?"昨天":864e3>a?Math.floor(a/86400)+"天前":31104e3>a&&r.getFullYear()==(new Date).getFullYear()?r.getMonth()+1+"月"+r.getDate()+"日":r.getFullYear()+"年"+(r.getMonth()+1)+"月"+r.getDate()+"日"}function compileCustomTag(e,t){var i,r=/^\w+:\s+([^\|]+)\s+\|\s+(.*?)$/,a=r.exec(t[1]);a&&(i=0==a[1].indexOf("$")?e(__GDATA__[a[1].substr(1)],a[2].replace(/['"]/g,"")):e(a[1],a[2].replace(/['"]/g,"")),append(i))}function getCustomTagHelper(e){if(0==o.__HELPER__.length)return!1;for(var t in o.__HELPER__)if(0==e.indexOf(o.tagPrefix+t+":"))return o.__HELPER__[t];return!1}document.getElementById(tpl)&&(tpl=document.getElementById(tpl));var __GDATA__=this.merge(this.GDATA,data),__CODE__="";append("var r = [];",!0);for(var __suffix="",__prefix="",i=0;i<this.tagSuffix.length;i++)__suffix+="\\"+this.tagSuffix[i];for(var i=0;i<this.tagPrefix.length;i++)__prefix+="\\"+this.tagPrefix[i];try{var reg=eval("/"+__prefix+"([^"+__suffix+"]+)"+__suffix+"/g")}catch(e){throw console.log(e),e}this.debug&&console.log(reg);for(var cursor=0,match;match=reg.exec(tpl);){append(template.slice(cursor,match.index)),cursor=match.index+match[0].length;var helper;match[0]!=this.tagPrefix+"/if"+this.tagSuffix&&match[0]!=this.tagPrefix+"/loop"+this.tagSuffix?match[0].inc(this.tagPrefix+"loop")?compileLoop(match[1]):match[0].inc(this.tagPrefix+"if")?complieIf(match[1]):match[0].inc(this.tagPrefix+"expr:")?compileExpr(match[1]):match[0].inc(this.tagPrefix+"wxtime:")?append(compileTimeString(match[1])):(helper=getCustomTagHelper(match[0]))?compileCustomTag(helper,match):compileVar(match[1]):__CODE__+="}\n"}return append(template.substr(cursor,template.length-cursor)),__CODE__+='return r.join("");',this.debug&&console.log(__CODE__),new Function(__CODE__).apply(__GDATA__)},o.merge=function(e,t){for(var i in t)e[i]=t[i];return e},o}();