/*!
 * BootstrapSelection v0.1.0 (https://coding.net/u/packy/p/bootstrap-chinese-region/git)
 * Copyright 2015 packy <lpreterite@126.com>
 * Licensed under MIT (https://coding.net/u/packy/p/bootstrap-chinese-region/git/blob/master/LICENSE)
 */
(function(a,b){if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=b()}else{if(typeof define==="function"&&define.amd){define("bs-chinese-region",["jquery","bootstrap"],b)}else{b(a.jQuery)}}})(window,function(b){var a=function(c){this._areas=[];this._defaultId="";this.$el=c;this.$input=this.$el.find("input[type=text]");this.$tabContent=this.$el.find(".tab-content");this.$tabContent.children().first().on("click","a",b.proxy(this.onClearAreas,this));this.$tabContent.children().on("click","a",b.proxy(this.onAreasChanged,this));this.$tabContent.children().last().on("click","a",b.proxy(this.onClose,this));this.$el.parents("form").on("submit",b.proxy(this.onSubmit,this));if(!!b.fn.dropdown.Constructor){this.initDropdownModule()}this._defaultId=this.$el.data("def-val")!==undefined?this.$el.find(this.$el.data("def-val")).val():this.$input.val();this.submitType=this.$el.data("submit-type");this.level(this.$el.data("min-level"),this.$el.data("max-level"))};a.prototype=new b.fn.dropdown.Constructor();a.prototype._toggle=a.prototype.toggle;a.prototype.toggle=function(){a.prototype._toggle.call(this.$input)};a.prototype.initDropdownModule=function(){this.$el.on("click",".dropdown-menu",function(c){b(c.target).trigger("click.bs.tab.data-api");c.stopPropagation()})};a.prototype.onClearAreas=function(c){this.areas=[]};a.prototype.onClose=function(d){this.toggle();var c=this.getAreaData(b(d.target));this.$el.trigger("completed.bs.chinese-region",[this.areas])};a.prototype.onSubmit=function(c){if(this.submitType=="id"){this.$input.val(this.areas[this.areas.length-1].id)}};a.prototype.getAreaData=function(c){var d=c.data();d.name=c.text();return d};a.prototype.onAreasChanged=function(d){var c=b(d.target).attr("data-id");this.areas=this.getCurrentAreas(c);this.renderAreasPanel(this.getAreasByParentId(c));this.$el.trigger("changed.bs.chinese-region",[this.areas])};a.prototype.getAreasByParentId=function(e){var c=[];for(var d=0;d<this._source.length;d++){if(this._source[d].level>this.maxLevel||this._source[d].level<this.minLevel){continue}if(this._source[d].parentId!=e){continue}c.push(this._source[d])}return c};a.prototype.getAreasByLevel=function(e){var c=[];for(var d=0;d<this._source.length;d++){if(this._source[d].level>this.maxLevel||this._source[d].level<this.minLevel){continue}if(this._source[d].level!=e){continue}c.push(this._source[d])}return c};a.prototype.getAreaById=function(e){var c;for(var d=0;d<this._source.length;d++){if(this._source[d].id==e){c=this._source[d];break}}return c};a.prototype.getCurrentAreas=function(f){var c=[];for(var d=this.minLevel;d<=this.maxLevel;d++){var e=this.getAreaById(f);if(e===undefined){break}if(e.level>this.maxLevel||e.level<this.minLevel){continue}c.unshift(e);f=e.parentId}return c};a.prototype.renderAreasPanel=function(f,h){var g,d;if(h){g=this.$tabContent.children(":first");d=this.$el.find(".nav-tabs li:first")}else{g=this.$tabContent.children(".active").next();d=this.$el.find(".nav-tabs li.active").next()}if(f&&f.length){g.empty();for(var c=0;c<f.length;c++){var e=f[c];g.append('<a href="javascript:;" class="areas-item" data-id="'+e.id+'" data-type="'+e.type+'">'+e.name+"</a> ")}}d.children("a").tab("show");this.$input.val("");this.$tabContent.children().find("a").removeClass("current");for(var c=0;c<this.areas.length;c++){this.$input.val(this.$input.val()+this.areas[c].name+" ");this.$tabContent.find("a[data-id="+this.areas[c].id+"]").addClass("current")}};a.prototype.render=function(e){this.renderAreasPanel(this.getAreasByLevel(this.minLevel),true);this.areas=this.getCurrentAreas(e);for(var c=0;c<this.areas.length;c++){var d=this.areas[c];this.renderAreasPanel(this.getAreasByParentId(d.id))}};a.prototype.source=function(d,c){if(arguments.length<=0){return this._source}this._source=typeof c=="function"?c(d):d;this.render(this._defaultId)};a.prototype.level=function(d,c){this.minLevel=d;this.maxLevel=c};Object.defineProperty(a.prototype,"areas",{configurable:false,get:function(){return this._areas},set:function(c){this._areas=c}});Object.defineProperty(a.prototype,"minLevel",{configurable:false,get:function(){return this._minLevel},set:function(c){this._minLevel=c}});Object.defineProperty(a.prototype,"maxLevel",{configurable:false,get:function(){return this._maxLevel},set:function(c){this._maxLevel=c}});b.fn.chineseRegion=function(){var d=Array.prototype.shift.apply(arguments),c=arguments,e=this.data("bs-chinese-region");if(e===undefined){this.data("bs-chinese-region",(e=new a(this)))}if(typeof d=="string"){e[d].apply(e,c)}return this};b.fn.chineseRegion.Constructor=a});